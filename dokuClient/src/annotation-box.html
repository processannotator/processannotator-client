<link rel="import" href="../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<dom-module id="annotation-box">

	<template>


		<style>

			:host {
				display: block;
				box-sizing: border-box;
				width: auto;
				height: auto;
			}
			
			paper-button {
				border-radius: 0px;
			}
			

			#container {
				display: flex;
				flex-direction: column;
				background-color: rgb(7, 20, 26);
				transition: background-color 0.3s ease-in-out;
				height: 10em;
				min-height: 10em;
				max-height: 15em;
				/*margin-bottom: 1em;*/
				
				cursor: pointer;
			}

			#container:hover {
				background-color: rgba(12, 38, 50, 1);

				/*-webkit-transform:rotateY(50deg);*/
				/*-webkit-transform:rotateZ(25deg);*/
			}

			#header,
			#main {
				padding: 0.25em;
				/*min-width: 100%;
				width: 100%;*/
			}
			
			#container, #tagsAndStatus {
				border-top: 1px solid rgb(21, 68, 89);
			}

			#header {
				padding: 0;
				flex: 1 0 0;
				display: flex;
				flex-direction: row;
				font-size: 1.2em;
				color: #4A4A4A;
				min-height: 1.5em;
				background-color: rgba(0,0,0,0);
			}

			#header > #letters_id {
				text-align: center;
				min-height: 1.5em;
				padding-top: 0.1em;
				padding-bottom: 0.1em;
				min-width: 1.5em;
				background: #9B9B9B;
				color: white;
				font-family: "SourceSansPro-Semibold";
			}

			#header > #profile_name {
				min-height: 100%;
				padding-left: 0.5em;
				padding-top: 0.1em;
				padding-bottom: 0.1em;
			}

			#main {
				flex: 4 0 0;
				background-color: rgba(0,0,0,0);
				color: rgb(197, 227, 241);
				font-size: 0.8em;
			}

			#tagsAndStatus {
				flex: 1.5 0 0;
				display: flex;
				flex-direction: row;
				color: rgb(197, 227, 241);
			}

			#tagsAndStatus > #tags, #status {
				flex: 1 0 0;

			}
			
			#tags {
				border-right: 1px solid rgb(21, 68, 89);
			}

		
			#statusList {
				padding: 0;
			}
			
			.comment {
				color: rgb(5, 73, 105);
			}
			
			.task {
				color: yellow;
			}
			
			.problem {
				color: orange;
			}

			paper-item {
				font-size: 0.8em;
			}
			
			.dropdown-content > paper-item {
				background-color:  rgb(7, 20, 26);
			}
			

			#footer {
				flex: 1 0 0;
				text-align: center;
				vertical-align: bottom;
				color: #303030;
				/*background-color: #696565;*/
			}
			#annotationText {
				cursor: text;
			}
		#annotationText:focus {
				outline: none;
			}


		</style>

		<div id="container" on-tap="tap">

			<div id="header">
				<div id="letters_id">[[computeNameLetters(annotation.creatorProfile.prename, annotation.creatorProfile.surname)]]</div>
				<div id="profile_name">
					<span>[[annotation.creatorProfile.prename]]</span>
					<span>[[annotation.creatorProfile.surname]]</span>
				</div>
			</div>

			<div id="main">
				<span>[[annotation.creationDate]]</span>
				<br>
				<div contenteditable="true" id="annotationText" on-keydown="keydown">{{annotation.description}}</div>
			</div>

			<div id="tagsAndStatus">
				<paper-button id="tags">Tags</paper-button>
				<paper-button class$="[[annotation.status]]" id="status" dropdown-trigger on-tap="openStatusDropdown">[[annotation.status]]</paper-button>
				<iron-dropdown always-on-top auto-fit-on-attach id="statusDropdown" horizontal-align="right" vertical-align="top">
					
<paper-listbox on-tap="clickedStatusList" attr-for-selected="label" selected="{{annotation.status}}" fallback-selection="[[annotation.status]]" id="statusList" on-iron-select="statusChanged" class="dropdown-content">
	<paper-item class="comment" label="comment">COMMENT</paper-item>
	<paper-item class="task" label="task">TASK</paper-item>
<paper-item class="problem" label="problem">PROBLEM</paper-item>
</paper-listbox>

				</iron-dropdown>


				<!-- <paper-dropdown-menu-light id="status" value={{annotation.status}} label="Status">
					<paper-listbox class="dropdown-content" id="statusList">
						<paper-item label="comment">Comment</paper-item>
						<paper-item label="task">Task</paper-item>
						<paper-item label="problem">Problem</paper-item>
					</paper-listbox>
				</paper-dropdown-menu-light> -->
				<!-- <paper-button class$="{{status}}" id="status" on-tap="statusChanged">Status</paper-button> -->
			</div>


			<!-- <div id="footer">
				<span>[[annotation.creatorProfile.prename]]</span>
			</div> -->
		</div>

	</template>

	<script>
		Polymer({
			is: "annotation-box",
			properties: {
				annotation: {
					type: Object,
					observer: "_annotationChanged"
				}
			},
			attached: function () {

			},
			_annotationChanged: function() {
				console.log(this.annotations);
				this.$.letters_id.style.backgroundColor = this.annotation.statusColor;
				this.$.header.style.color = this.annotation.statusColor;
			},
			keydown: function (event) {
				// FIXME: data binding would be useful here like:
				//console.log(this.annotation.description);
				//Doesnt work. maybe because of iron-list?
				// console.log(this.$.annotationText.innerHTML);
				if (event.defaultPrevented)
					return; // Should do nothing if the key event was already consumed.

				if(event.keyIdentifier === 'Enter'){
					event.preventDefault();
					this.handleEdit(event);
				}
			},
			handleEdit: function(event, detail, sender) {
				this.annotation.description = event.srcElement.innerHTML;
				this.fire('annotation-edited-by-user', {newAnnotation: this.annotation, elem: this});
			},
			computeNameLetters: function (prename, surname) {
				return prename[0] + surname[0];
			},
			tap: function () {
				this.fire('annotation-box-mouse-enter', this.annotation);
			},
			clickedStatusList: function (e) {
				this.fire('annotation-edited-by-user', {newAnnotation: this.annotation, elem: this});
			},
			statusChanged: function (e) {
				this.$.statusDropdown.close();
				console.log('status changed...');

			},
			openStatusDropdown: function (e) {
					this.$.statusDropdown.toggle();
			},

		});
	</script>

</dom-module>
