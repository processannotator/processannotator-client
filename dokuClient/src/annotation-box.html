<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="annotation-box">

	<template>
		<style>

			:host {
				display: block;
				box-sizing: border-box;
				perspective: 600px;
				width: auto;
				height: auto;
			}

			:host:hover {

}

			#container {
				display: flex;
				flex-direction: column;
				background-color: none;
				transition: background-color 0.3s ease-in-out;
				height: 10em;
				min-height: 10em;
				max-height: 15em;
				/*margin-bottom: 1em;*/
				border-top: 1px solid rgb(21, 68, 89);
				cursor: pointer;
			}

			#container:hover {
				background-color: rgba(12, 38, 50, 1);

				/*-webkit-transform:rotateY(50deg);*/
				/*-webkit-transform:rotateZ(25deg);*/
			}

			#header,
			#main,
			#tags,
			#task,
			#footer {
				padding: 0.25em;
				/*min-width: 100%;
				width: 100%;*/
			}

			#header {
				padding: 0;
				flex: 1 0 0;
				display: flex;
				flex-direction: row;
				font-size: 1.2em;
				color: #4A4A4A;
				min-height: 1.5em;
				background-color: rgba(0,0,0,0);
			}

			#header > #letters_id {
				text-align: center;
				min-height: 1.5em;
				padding-top: 0.1em;
				padding-bottom: 0.1em;
				min-width: 1.5em;
				background: #9B9B9B;
				color: white;
				font-family: "SourceSansPro-Semibold";
			}

			#header > #profile_name {
				min-height: 100%;
				padding-left: 0.5em;
				padding-top: 0.1em;
				padding-bottom: 0.1em;
			}

			#main {
				flex: 4 0 0;
				background-color: rgba(0,0,0,0);
				color: rgb(197, 227, 241);
				font-size: 0.8em;
			}

			#tags_and_tasks {
				flex: 1 0 0;
				display: flex;
				flex-direction: row;
				padding: 0.5em;
				color: rgb(197, 227, 241);
			}

			#tags_and_tasks > #tags {
				flex: 2 0 0;
				vertical-align: middle;
				/*background-color: #4A4A4A;*/
			}

			#tags_and_tasks > #task {
				flex: 1 0 0;
				text-align: center;
			}

			#task:hover {
				cursor: pointer;
			}

			#footer {
				flex: 1 0 0;
				text-align: center;
				vertical-align: bottom;
				color: #303030;
				/*background-color: #696565;*/
			}
			.annotationText {
				cursor: text;
			}
			.annotationText:focus {
				outline: none;
			}


		</style>

		<div id="container" on-tap="tap">

			<div id="header">
				<div style.backgroundColor="" id="letters_id">[[computeNameLetters(annotation.creatorProfile.prename, annotation.creatorProfile.surname)]]</div>
				<div id="profile_name">
					<span>[[annotation.creatorProfile.prename]]</span>
					<span>[[annotation.creatorProfile.surname]]</span>
				</div>
			</div>

			<div id="main">
				<span>[[annotation.creationDate]]</span>
				<br>
				<div contenteditable="true" class="annotationText" on-keydown="keydown">{{annotation.description}}</div>
			</div>

			<div id="tags_and_tasks">
				<div id="tags">Tag1, tag2, tag3</div>
				<div id="task">task</div>
			</div>


			<!-- <div id="footer">
				<span>[[annotation.creatorProfile.prename]]</span>
			</div> -->
		</div>

	</template>

	<script>
		Polymer({
			is: "annotation-box",
			properties: {
				annotation: {
					type: Object,
					observer: "_annotationChanged"
				}
			},
			_annotationChanged: function() {
				this.$.letters_id.style.backgroundColor = this.annotation.creatorProfile.color;
				this.$.header.style.color = this.annotation.creatorProfile.color;
			},
			keydown: function (event) {
				if (event.defaultPrevented)
					return; // Should do nothing if the key event was already consumed.

				if(event.keyIdentifier === 'Enter'){
					event.preventDefault();
					this.handleTextChange(event);
				}
			},
			handleTextChange: function(event, detail, sender) {
				this.annotation.description = event.srcElement.innerHTML;
				this.fire('annotation-edited-by-user', {newAnnotation: this.annotation, elem: this});
			},
			computeNameLetters: function (prename, surname) {
				return prename[0] + surname[0];
			},
			tap: function () {
				this.fire('annotation-box-mouse-enter', this.annotation);
			}

		});
	</script>

</dom-module>
